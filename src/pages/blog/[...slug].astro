---
import BlogPost from '../../layouts/BlogPost.astro';
import { getBlogPosts } from '../../lib/contentful';
import { marked } from 'marked';

export async function getStaticPaths() {
	const posts = await getBlogPosts();
	
	if (!posts || posts.length === 0) {
		console.warn('No blog posts found from Contentful');
		return [];
	}

	return posts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

interface Props {
	post: {
		title: string;
		description: string;
		pubDate: string;
		updatedDate?: string;
		heroImage?: { url: string; title?: string };
		body: string;
	};
}

const { post } = Astro.props as Props;

if (!post) {
	return new Response('Post not found', { status: 404 });
}

const htmlContent = await marked(post.body);
---

<BlogPost title={post.title} description={post.description} pubDate={new Date(post.pubDate)} updatedDate={post.updatedDate ? new Date(post.updatedDate) : undefined} heroImage={post.heroImage?.url}>
	<div set:html={htmlContent} />
</BlogPost>
